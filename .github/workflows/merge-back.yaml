name: Merge back in develop

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'branch to merge in develop'
      target_branch:

jobs:
  merge-back:
    runs-on: ubuntu-latest
    steps:
      # - name: Clone Repo
      #   uses: actions/checkout@v3
      #   with:
      #     ref: ${{ github.event.inputs.branch }}
      #     fetch-depth: 0
      - run: |
          eval `ssh-agent -s`
          echo ${{ secrets.GIT_KEY }} > gitactions.pub
          chmod 644 gitactions.pub
          ssh-add gitactions.pub
          git clone git@github.com:jhonsouza/rest-api-4.git .
          git fetch git@github.com:jhonsouza/rest-api-4.git
          git checkout -B ${{ github.event.inputs.target_branch }}; git checkout -B ${{ github.event.inputs.target_branch }} refs/remotes/origin/${{ github.event.inputs.target_branch }}
          git config push.default simple
          git config user.email "jhonatan.siqueira@passeidireto.com"
          git config user.name "jhonatan siqueira"
          git merge remotes/origin/${{ github.event.inputs.branch }} --no-off --no-commit

          # check if package.json exists and ignore
          [ -f package.json ] && git reset HEAD package.json || echo "package.json doesn't exist"
          [ -f package.json ] && git checkout -- package.json || echo "package.json doesn't exist"

          git commit -m "Auto-merge" --allow-empty
          git push git@github.com:jhonsouza/rest-api-4.git ${{ github.event.inputs.target_branch }}:${{ github.event.inputs.target_branch }}
          ssh-agent -k